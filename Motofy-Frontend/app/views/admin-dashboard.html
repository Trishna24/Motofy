<!-- app/views/admin-dashboard.html -->
<div class="admin-dashboard">
  <!-- Admin Header -->
  <header class="admin-header">
    <div class="admin-header-content">
      <div class="admin-brand">
        <h1>Motofy Admin</h1>
        <span class="admin-subtitle">Car Rental Management</span>
      </div>
      
      <!-- Admin User -->
      <div class="admin-user">
        <button class="admin-visit-user-btn" ng-click="adminDashboard.visitUserPage()">
          <span class="btn-icon">üåê</span>
          Visit User Page
        </button>
        <button class="admin-logout-btn" ng-click="adminDashboard.logout()">Logout</button>
      </div>
    </div>
 </header>

  <!-- Admin Navigation -->
  <nav class="admin-nav">
    <div class="admin-nav-content">
      <a href="" class="nav-item" 
         ng-click="adminDashboard.showSection('dashboard')" 
         ng-class="{'active': adminDashboard.activeSection === 'dashboard'}">
        <span class="nav-icon">üìä</span> Dashboard
      </a>
      <a href="" class="nav-item" 
         ng-click="adminDashboard.showSection('cars')" 
         ng-class="{'active': adminDashboard.activeSection === 'cars'}">
        <span class="nav-icon">üöó</span> Cars
      </a>
      <a href="" class="nav-item" 
         ng-click="adminDashboard.showSection('users')" 
         ng-class="{'active': adminDashboard.activeSection === 'users'}">
        <span class="nav-icon">üë•</span> Users
      </a>
      <a href="" class="nav-item" 
         ng-click="adminDashboard.showSection('bookings')" 
         ng-class="{'active': adminDashboard.activeSection === 'bookings'}">
        <span class="nav-icon">üìã</span> Bookings
      </a>
      <a href="" class="nav-item" 
         ng-click="adminDashboard.showSection('analytics')" 
         ng-class="{'active': adminDashboard.activeSection === 'analytics'}">
        <span class="nav-icon">üìà</span> Analytics
      </a>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="admin-main">
    <div class="admin-container">

      <!-- DASHBOARD SECTION -->
      <div ng-show="adminDashboard.activeSection === 'dashboard'">
        <div class="welcome-section">
          <h2>Welcome back, {{adminDashboard.adminData.username}}!</h2>
          <p>Here's what's happening with your car rental platform today.</p>
        </div>

        <!-- Quick Stats -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon">üöó</div>
            <div class="stat-content">
              <h3>{{adminDashboard.stats.totalCars}}</h3>
              <p>Total Cars</p>
            </div>
           </div>
          <div class="stat-card">
            <div class="stat-icon">üë•</div>
            <div class="stat-content">
              <h3>{{adminDashboard.stats.totalUsers}}</h3>
              <p>Total Users</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">üìã</div>
            <div class="stat-content">
              <h3>{{adminDashboard.stats.totalBookings}}</h3>
              <p>Total Bookings</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">üí∞</div>
            <div class="stat-content">
              <h3>‚Çπ{{adminDashboard.stats.totalRevenue}}</h3>
              <p>Total Revenue</p>
            </div>
          </div>
        </div>
        
        <!-- Booking Stats -->
        <div class="booking-stats-section">
          <h3>Booking Statistics</h3>
          <div class="booking-stats-grid">
            <div class="booking-stat-card pending">
              <div class="booking-stat-icon">‚è≥</div>
              <div class="booking-stat-content">
                <h4>{{adminDashboard.stats.pendingBookings || 0}}</h4>
                <p>Pending</p>
              </div>
            </div>
            <div class="booking-stat-card confirmed">
              <div class="booking-stat-icon">‚úÖ</div>
              <div class="booking-stat-content">
                <h4>{{adminDashboard.stats.confirmedBookings || 0}}</h4>
                <p>Confirmed</p>
              </div>
            </div>
            <div class="booking-stat-card cancelled">
              <div class="booking-stat-icon">‚ùå</div>
              <div class="booking-stat-content">
                <h4>{{adminDashboard.stats.cancelledBookings || 0}}</h4>
                <p>Cancelled</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
          <h3>Quick Actions</h3>
          <div class="actions-grid">
            <button class="action-btn" ng-click="adminDashboard.showSection('cars')">
              <span class="action-icon">‚ûï</span> Add New Car
            </button>
            <button class="action-btn" ng-click="adminDashboard.showSection('bookings')">
              <span class="action-icon">üìã</span> View Bookings
            </button>
            <button class="action-btn" ng-click="adminDashboard.showSection('users')">
              <span class="action-icon">üë•</span> Manage Users
            </button>
            <button class="action-btn" ng-click="adminDashboard.showSection('analytics')">
              <span class="action-icon">üìà</span> View Analytics
            </button>
          </div>
        </div>

        <!-- Recent Activity -->
        <div class="recent-activity">
          <h3>Recent Activity</h3>
          <div class="activity-list">
            <div ng-repeat="activity in adminDashboard.recentActivity" class="activity-item">
              <div class="activity-icon">{{activity.icon}}</div>
              <div class="activity-content">
                <p class="activity-text">{{activity.text}}</p>
                <span class="activity-time">{{activity.time}}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- CARS SECTION -->
      <div ng-show="adminDashboard.activeSection === 'cars'" ng-controller="AdminCarController as adminCar">
        <h2>Car Management</h2>

       <!-- Top actions -->
        <div class="admin-toolbar">
          <button class="btn primary" ng-click="adminCar.toggleView()">
            {{adminCar.viewMode === 'list' ? '+ Add Car' : '‚Üê Back to List'}}
          </button>
          <button class="btn" ng-if="adminCar.viewMode === 'list'" ng-click="adminCar.loadCars()">Refresh</button>
        </div>


        <!-- Alerts -->
        <p class="text-success" ng-if="adminCar.success">{{adminCar.success}}</p>
        <p class="text-error" ng-if="adminCar.error">{{adminCar.error}}</p>

        <!-- LIST VIEW -->
        <div ng-show="adminCar.viewMode === 'list'">
          <table class="table">
            <thead>
              <tr>
                <th>Image</th>
                <th>Name</th>
                <th>Brand</th>
                <th>Car Number</th>
                <th>Fuel</th>
                <th>Seats</th>
                <th>Transmission</th>
                <th>Price</th>
                <th>Status</th>
                <th style="width:180px;">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr ng-repeat="car in adminCar.cars">
                <td>
                  <img ng-if="car.image" ng-src="{{adminCar.imageUrl(car.image)}}" alt="{{car.name}}" style="width:70px;height:48px;object-fit:cover;border-radius:6px;">
                  <span ng-if="!car.image" class="muted">No image</span>
                </td>
                <td>{{car.name}}</td>
                <td>{{car.brand}}</td>
                <td>{{car.carNumber}}</td>
                <td>{{car.fuelType}}</td>
                <td>{{car.seats}}</td>
                <td>{{car.transmission}}</td>
                <td>‚Çπ{{car.price | number}}</td>
                <td>
                  <span class="status-badge" ng-class="{'status-available': car.status === 'Available', 'status-booked': car.status === 'Booked', 'status-unavailable': car.status === 'Maintenance'}">
                    {{car.status === 'Available' ? 'Available' : (car.status === 'Booked' ? 'Booked' : 'Maintenance')}}
                  </span>
                </td>
                <td>
                  <!-- Improved Status Selector -->
                  <div class="status-selector-container">
                    <div class="status-toggle-group">
                      <button class="status-toggle-btn" 
                              ng-class="{'active': car.status === 'Available'}"
                              ng-click="adminCar.changeCarStatus(car, 'Available')"
                              title="Set as Available">
                        <i class="fas fa-check-circle"></i>
                        <span>Available</span>
                      </button>
                      <button class="status-toggle-btn" 
                              ng-class="{'active': car.status === 'Booked'}"
                              ng-click="adminCar.changeCarStatus(car, 'Booked')"
                              title="Set as Booked">
                        <i class="fas fa-calendar-check"></i>
                        <span>Booked</span>
                      </button>
                      <button class="status-toggle-btn" 
                              ng-class="{'active': car.status === 'Maintenance'}"
                              ng-click="adminCar.changeCarStatus(car, 'Maintenance')"
                              title="Set as Maintenance">
                        <i class="fas fa-tools"></i>
                        <span>Maintenance</span>
                      </button>
                    </div>
                  </div>
                  
                  <!-- Action Buttons -->
                  <div class="action-buttons-group">
                    <button class="btn btn-sm btn-edit" ng-click="adminCar.showEditForm(car)" title="Edit Car">
                      <i class="fas fa-edit"></i> Edit
                    </button>
                    <button class="btn btn-sm btn-danger" ng-click="adminCar.deleteCar(car._id)" title="Delete Car">
                      <i class="fas fa-trash"></i> Delete
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
          <div ng-if="!adminCar.cars.length" class="muted">No cars yet.</div>
        </div>

        <!-- FORM VIEW (Add/Edit) -->
        <div ng-show="adminCar.viewMode === 'form'" class="admin-form-container">
          <h3 ng-if="!adminCar.editingId" class="form-title">Add New Car</h3>
          <h3 ng-if="adminCar.editingId" class="form-title">Edit Car Details</h3>

          <form ng-submit="adminCar.saveCar()" novalidate class="admin-form">
            <div class="form-grid">
              <label>
                <span>Car Name</span>
                <input type="text" ng-model="adminCar.formData.name" required placeholder="Enter car name">
              </label>
              <label>
                <span>Brand</span>
                <input type="text" ng-model="adminCar.formData.brand" required placeholder="Enter car brand">
              </label>
              <label>
                <span>Car Number</span>
                <input type="text" ng-model="adminCar.formData.carNumber" required placeholder="Enter car number">
              </label>
              <label>
                <span>Price (‚Çπ)</span>
                <input type="number" ng-model="adminCar.formData.price" required placeholder="Enter price per day">
              </label>
              <label>
                <span>Fuel Type</span>
                <input type="text" ng-model="adminCar.formData.fuelType" required placeholder="Petrol/Diesel/Electric">
              </label>
              <label>
                <span>Seats</span>
                <input type="number" ng-model="adminCar.formData.seats" required placeholder="Number of seats">
              </label>
              <label>
                <span>Transmission</span>
                <input type="text" ng-model="adminCar.formData.transmission" required placeholder="Manual/Automatic">
              </label>
            </div>

            <label>
              <span>Description</span>
              <textarea ng-model="adminCar.formData.description" rows="3" placeholder="Enter car description and features"></textarea>
            </label>

            <div class="form-row">
              <label>
                <span>Car Image (optional)</span>
                <input type="file" file-model="adminCar.formData.imageFile" accept="image/*">
              </label>
              <div ng-if="adminCar.previewUrl" class="img-preview">
                <img ng-src="{{adminCar.previewUrl}}" alt="Car preview">
              </div>
            </div>

            <div class="form-actions">
              <button class="btn" type="submit">{{adminCar.editingId ? 'Update' : 'Add'}} Car</button>
              <button class="btn btn-ghost" type="button" ng-click="adminCar.cancelForm()">Cancel</button>
            </div>
          </form>
        </div>
      </div>

      <!-- USERS SECTION -->
      <div ng-show="adminDashboard.activeSection === 'users'" ng-controller="AdminUserController as adminUser" ng-init="adminUser.init()">
          
          <!-- Back Button for Detail View -->
          <div ng-if="adminUser.viewMode === 'detail' && !adminUser.editMode" class="detail-nav">
            <button class="btn btn-outline" ng-click="adminUser.backToList()">
              <i class="fa fa-arrow-left"></i> Back to User List
            </button>
          </div>
 
          <!-- Error and Success Messages -->
          <div ng-if="adminUser.error" class="error-message">
            <i class="fa fa-exclamation-circle"></i> {{adminUser.error}}
          </div>
          <div ng-if="adminUser.success" class="success-message">
            <i class="fa fa-check-circle"></i> <span style="margin-left: 8px;">{{adminUser.success}}</span>
          </div>

        <!-- LIST VIEW -->
        <div ng-show="adminUser.viewMode === 'list'">
          <h2>User Management</h2>
          
          <!-- User Filters -->
          <div class="user-filters">
            <div class="search-filter">
              <input type="text" ng-model="adminUser.searchQuery" placeholder="Search by username or email..." class="form-control">
            </div>
            <div class="status-filter">
              <select ng-model="adminUser.statusFilter" class="form-control">
                <option value="all">All Status</option>
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
                <option value="suspended">Suspended</option>
              </select>
            </div>
          </div>
          
          <!-- Loading Message -->
          <div ng-if="adminUser.loading" class="loading-message">
            <i class="fa fa-spinner fa-spin"></i> Loading users...
          </div>
          
          <!-- Users Table -->
          <table class="admin-table" ng-if="!adminUser.loading && adminUser.filteredUsers.length > 0">
            <thead>
              <tr>
                <th ng-click="adminUser.sortBy('username')">
                  Username
                  <span ng-show="adminUser.sortKey === 'username'" ng-class="{'fa fa-caret-up': !adminUser.sortReverse, 'fa fa-caret-down': adminUser.sortReverse}"></span>
                </th>
                <th ng-click="adminUser.sortBy('email')">
                  Email
                  <span ng-show="adminUser.sortKey === 'email'" ng-class="{'fa fa-caret-up': !adminUser.sortReverse, 'fa fa-caret-down': adminUser.sortReverse}"></span>
                </th>
                <th ng-click="adminUser.sortBy('createdAt')">
                  Joined Date
                  <span ng-show="adminUser.sortKey === 'createdAt'" ng-class="{'fa fa-caret-up': !adminUser.sortReverse, 'fa fa-caret-down': adminUser.sortReverse}"></span>
                </th>
                <th ng-click="adminUser.sortBy('status')">
                  Status
                  <span ng-show="adminUser.sortKey === 'status'" ng-class="{'fa fa-caret-up': !adminUser.sortReverse, 'fa fa-caret-down': adminUser.sortReverse}"></span>
                </th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr ng-repeat="user in adminUser.filteredUsers">
                <td>{{user.username}}</td>
                <td>{{user.email}}</td>
                <td>{{adminUser.formatDate(user.createdAt)}}</td>
                <td>
                  <span class="status-badge" ng-class="{
                    'status-confirmed': user.status === 'active',
                    'status-pending': user.status === 'inactive',
                    'status-cancelled': user.status === 'suspended'
                  }">
                    {{user.status}}
                  </span>
                </td>
                <td>
                  <div class="action-buttons">
                    <button class="btn btn-sm btn-primary" ng-click="adminUser.viewUserDetails(user)">
                      <i class="fa fa-eye"></i> View
                    </button>
                    <button class="btn btn-sm btn-success" ng-if="user.status !== 'active'" ng-click="adminUser.updateUserStatus(user, 'active')">
                      <i class="fa fa-check"></i> Activate
                    </button>
                    <button class="btn btn-sm btn-warning" ng-if="user.status !== 'inactive'" ng-click="adminUser.updateUserStatus(user, 'inactive')">
                      <i class="fa fa-pause"></i> Deactivate
                    </button>
                    <button class="btn btn-sm btn-danger" ng-if="user.status !== 'suspended'" ng-click="adminUser.updateUserStatus(user, 'suspended')">
                      <i class="fa fa-ban"></i> Suspend
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
          
          <!-- No Users Message -->
          <div ng-if="!adminUser.loading && adminUser.filteredUsers.length === 0" class="no-data-message">
            No users found matching your criteria.
          </div>
        </div>

        <!-- DETAIL VIEW -->
        <div ng-show="adminUser.viewMode === 'detail'" class="user-detail-container">
          <div class="user-detail-header">
            <h3>User Details - {{adminUser.selectedUser.username}}</h3>
            <div class="user-detail-actions">
              <button class="btn-outline" ng-if="!adminUser.editMode" ng-click="adminUser.enableEdit()">Edit User</button>
              <button class="btn-confirm" ng-if="adminUser.editMode" ng-click="adminUser.saveUser()">Save Changes</button>
              <button class="btn-outline" ng-if="adminUser.editMode" ng-click="adminUser.cancelEdit()">Cancel</button>
              <button class="btn btn-outline" ng-if="adminUser.editMode" ng-click="adminUser.backToList()">
                <i class="fa fa-arrow-left"></i> Back to User List
              </button>
            </div>
          </div>

          <div class="user-detail-content">
            <!-- View Mode -->
            <div ng-if="!adminUser.editMode" class="user-detail-grid">
              <div class="detail-section">
                <h4>User Information</h4>
                <div class="user-profile">
                  <div class="user-avatar">
                    <img ng-src="{{adminUser.getProfilePictureUrl(adminUser.selectedUser.profilePicture)}}" 
                         alt="{{adminUser.selectedUser.username}}" 
                         onerror="this.src='assets/images/default-avatar.svg'">
                  </div>
                  <div class="user-info">
                    <!-- Basic Information -->
                    <div class="detail-row">
                      <span class="detail-label">Username:</span>
                      <span class="detail-value">{{adminUser.selectedUser.username}}</span>
                    </div>
                    <div class="detail-row">
                      <span class="detail-label">Email:</span>
                      <span class="detail-value">{{adminUser.selectedUser.email}}</span>
                    </div>
                    <div class="detail-row" ng-if="adminUser.selectedUser.phone">
                      <span class="detail-label">Phone:</span>
                      <span class="detail-value">{{adminUser.selectedUser.phone}}</span>
                    </div>
                    <div class="detail-row">
                      <span class="detail-label">Status:</span>
                      <span class="status-badge" ng-class="{
                        'status-confirmed': adminUser.selectedUser.status === 'active',
                        'status-pending': adminUser.selectedUser.status === 'inactive',
                        'status-cancelled': adminUser.selectedUser.status === 'suspended'
                      }">
                        {{adminUser.selectedUser.status}}
                      </span>
                    </div>
                    <div class="detail-row">
                      <span class="detail-label">Joined:</span>
                      <span class="detail-value">{{adminUser.formatDate(adminUser.selectedUser.createdAt)}}</span>
                    </div>
                    <div class="detail-row" ng-if="adminUser.selectedUser.googleId">
                      <span class="detail-label">Google Account:</span>
                      <span class="detail-value">
                        <i class="fab fa-google"></i> Connected
                      </span>
                    </div>
                    
                    <!-- Address Information -->
                    <div ng-if="adminUser.selectedUser.address && (adminUser.selectedUser.address.street || adminUser.selectedUser.address.city || adminUser.selectedUser.address.state)">
                      <h5 style="margin-top: 20px; margin-bottom: 10px; color: #333;">Address Information</h5>
                      <div class="detail-row" ng-if="adminUser.selectedUser.address.street">
                        <span class="detail-label">Street:</span>
                        <span class="detail-value">{{adminUser.selectedUser.address.street}}</span>
                      </div>
                      <div class="detail-row" ng-if="adminUser.selectedUser.address.city">
                        <span class="detail-label">City:</span>
                        <span class="detail-value">{{adminUser.selectedUser.address.city}}</span>
                      </div>
                      <div class="detail-row" ng-if="adminUser.selectedUser.address.state">
                        <span class="detail-label">State:</span>
                        <span class="detail-value">{{adminUser.selectedUser.address.state}}</span>
                      </div>
                      <div class="detail-row" ng-if="adminUser.selectedUser.address.zipCode">
                        <span class="detail-label">ZIP Code:</span>
                        <span class="detail-value">{{adminUser.selectedUser.address.zipCode}}</span>
                      </div>
                      <div class="detail-row" ng-if="adminUser.selectedUser.address.country">
                        <span class="detail-label">Country:</span>
                        <span class="detail-value">{{adminUser.selectedUser.address.country}}</span>
                      </div>
                    </div>
                    
                    <!-- Additional Information -->
                    <div ng-if="adminUser.selectedUser.drivingLicense || adminUser.selectedUser.preferences">
                      <h5 style="margin-top: 20px; margin-bottom: 10px; color: #333;">Additional Information</h5>
                      
                      <!-- License Preview Section for Admin -->
                      <div class="detail-row" ng-if="adminUser.selectedUser.drivingLicense">
                        <span class="detail-label">Driving License:</span>
                        <div class="admin-license-preview">
                          <div class="license-status">
                            <i class="fas fa-id-card"></i> 
                            <span class="license-uploaded">Document Uploaded</span>
                          </div>
                          
                          <!-- License Preview Container -->
                          <div class="admin-license-document" ng-if="adminUser.selectedUser.drivingLicense">
                            <div class="license-preview-header">
                              <h6><i class="fas fa-file-alt"></i> License Document Preview</h6>
                              <button class="btn-download" ng-click="adminUser.downloadLicense(adminUser.selectedUser)" title="Download License">
                                <i class="fas fa-download"></i>
                              </button>
                            </div>
                            
                            <!-- License Image/Document Display -->
                            <div class="license-display">
                              <img ng-src="{{adminUser.getLicenseUrl(adminUser.selectedUser.drivingLicense)}}" 
                                   alt="Driving License Document" 
                                   class="license-image"
                                   ng-if="adminUser.isImageFile(adminUser.selectedUser.drivingLicense)"
                                   onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                              
                              <!-- Fallback for non-image files -->
                              <div class="license-file-info" ng-if="!adminUser.isImageFile(adminUser.selectedUser.drivingLicense)" style="display: none;">
                                <i class="fas fa-file-pdf fa-3x"></i>
                                <p>{{adminUser.selectedUser.drivingLicense}}</p>
                                <small>Click download to view document</small>
                              </div>
                            </div>
                            
                            <!-- License Details -->
                            <div class="license-details">
                              <div class="license-info-row">
                                <span class="info-label">File Name:</span>
                                <span class="info-value">{{adminUser.getLicenseFileName(adminUser.selectedUser.drivingLicense)}}</span>
                              </div>
                              <div class="license-info-row">
                                <span class="info-label">Upload Date:</span>
                                <span class="info-value">{{adminUser.formatDate(adminUser.selectedUser.licenseUploadDate || adminUser.selectedUser.updatedAt)}}</span>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Edit Mode -->
            <div ng-if="adminUser.editMode" class="user-edit-form">
              <div class="form-grid">
                <label>
                  <span>Username</span>
                  <input type="text" ng-model="adminUser.selectedUser.username">
                </label>
                <label>
                  <span>Email</span>
                  <input type="email" ng-model="adminUser.selectedUser.email">
                </label>
                <label>
                  <span>Phone</span>
                  <input type="tel" ng-model="adminUser.selectedUser.phone" placeholder="10-digit phone number">
                </label>
                <label>
                  <span>Status</span>
                  <select ng-model="adminUser.selectedUser.status">
                    <option value="active">Active</option>
                    <option value="inactive">Inactive</option>
                    <option value="suspended">Suspended</option>
                  </select>
                </label>
              </div>
              
              <!-- Address Section -->
              <h5 style="margin-top: 20px; margin-bottom: 10px; color: #333;">Address Information</h5>
              <div class="form-grid">
                <label>
                  <span>Street</span>
                  <input type="text" ng-model="adminUser.selectedUser.address.street" placeholder="Street address">
                </label>
                <label>
                  <span>City</span>
                  <input type="text" ng-model="adminUser.selectedUser.address.city" placeholder="City">
                </label>
                <label>
                  <span>State</span>
                  <input type="text" ng-model="adminUser.selectedUser.address.state" placeholder="State">
                </label>
                <label>
                  <span>ZIP Code</span>
                  <input type="text" ng-model="adminUser.selectedUser.address.zipCode" placeholder="ZIP Code">
                </label>
                <label>
                  <span>Country</span>
                  <input type="text" ng-model="adminUser.selectedUser.address.country" placeholder="Country">
                </label>
              </div>
            </div>

            <!-- Booking Activity Section -->
            <div class="detail-section">
              <h4>Booking Activity</h4>
              <div ng-if="adminUser.loadingBookings" class="loading-message">
                <i class="fa fa-spinner fa-spin"></i> Loading booking activity...
              </div>
              <div ng-if="!adminUser.loadingBookings && adminUser.userBookings.length === 0" class="no-data-message">
                No booking activity found for this user.
              </div>
              <table class="admin-table" ng-if="!adminUser.loadingBookings && adminUser.userBookings.length > 0">
                <thead>
                  <tr>
                    <th>Car</th>
                    <th>Pickup Date</th>
                    <th>Return Date</th>
                    <th>Pickup Location</th>
                    <th>Return Location</th>
                    <th>Duration</th>
                    <th>Amount</th>
                    <th>Status</th>
                    <th>Booked On</th>
                  </tr>
                </thead>
                <tbody>
                  <tr ng-repeat="booking in adminUser.userBookings">
                    <td>{{booking.car.name || booking.car.make}} {{booking.car.brand || booking.car.model}}</td>
                    <td>{{booking.pickupDate | date:'dd MMM yyyy, h:mm a'}}</td>
                    <td>{{booking.dropoffDate | date:'dd MMM yyyy, h:mm a'}}</td>
                    <td>{{booking.pickupLocation}}</td>
                    <td>{{booking.dropoffLocation || 'Same as pickup'}}</td>
                    <td>{{adminUser.calculateDuration(booking.pickupDate, booking.dropoffDate)}} days</td>
                    <td>‚Çπ{{booking.totalAmount}}</td>
                    <td>
                      <span class="status-badge" ng-class="{
                        'status-confirmed': booking.status === 'Confirmed',
                        'status-pending': booking.status === 'Pending',
                        'status-cancelled': booking.status === 'Cancelled'
                      }">
                        {{booking.status}}
                      </span>
                    </td>
                    <td>{{adminUser.getTimeAgo(booking.createdAt)}}</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- Action Buttons -->
            <div class="user-actions" ng-if="!adminUser.editMode">
              <button class="btn-confirm" ng-if="adminUser.selectedUser.status !== 'active'" ng-click="adminUser.updateUserStatus(adminUser.selectedUser, 'active')">Activate User</button>
              <button class="btn-warning" ng-if="adminUser.selectedUser.status !== 'inactive'" ng-click="adminUser.updateUserStatus(adminUser.selectedUser, 'inactive')">Deactivate User</button>
              <button class="btn-cancel" ng-if="adminUser.selectedUser.status !== 'suspended'" ng-click="adminUser.updateUserStatus(adminUser.selectedUser, 'suspended')">Suspend User</button>
            </div>
          </div>
        </div>
      </div>
          <!-- BOOKINGS SECTION -->
    <div class="admin-bookings-section" ng-show="adminDashboard.activeSection === 'bookings'" ng-controller="AdminBookingController as adminBooking">
        <h2>Booking Management</h2>

        <!-- Top actions -->
        <div class="admin-toolbar">
          <button class="btn primary" ng-if="adminBooking.viewMode === 'detail'" ng-click="adminBooking.backToList()">
            ‚Üê Back to List
          </button>
          <button class="btn" ng-if="adminBooking.viewMode === 'list'" ng-click="adminBooking.loadBookings()">Refresh</button>
        </div>

        <!-- Alerts -->
        <p class="text-success" ng-if="adminBooking.success">{{adminBooking.success}}</p>
        <p class="text-error" ng-if="adminBooking.error">{{adminBooking.error}}</p>

        <!-- Loading state -->
        <div ng-if="adminBooking.loading" class="loading-state">
          <p>Loading bookings...</p>
        </div>

        <!-- LIST VIEW -->
        <div ng-show="adminBooking.viewMode === 'list'" ng-if="!adminBooking.loading">
          <!-- Filters and Search -->
          <div class="booking-filters">
            <div class="filter-group">
              <label class="filter-label">Status</label>
              <select ng-model="adminBooking.statusFilter">
                <option value="">All Statuses</option>
                <option value="Pending">Pending</option>
                <option value="Confirmed">Confirmed</option>
                <option value="Cancelled">Cancelled</option>
              </select>
            </div>
            <div class="filter-group">
              <label class="filter-label">Date Range</label>
              <input type="date" ng-model="adminBooking.startDate" placeholder="From">
              <input type="date" ng-model="adminBooking.endDate" placeholder="To">
            </div>
            <div class="filter-actions">
              <button class="btn" ng-click="adminBooking.resetFilters()">Reset</button>
            </div>
            <div class="search-box">
              <input type="text" ng-model="adminBooking.searchTerm" placeholder="Search bookings...">
            </div>
          </div>
          
          <!-- Bookings Table -->
          <div class="table-container" ng-if="adminBooking.filteredBookings.length > 0">
            <table class="booking-table">
              <thead>
                <tr>
                  <th ng-click="adminBooking.setSortBy('_id')">Booking ID</th>
                  <th ng-click="adminBooking.setSortBy('user.username')">User</th>
                  <th ng-click="adminBooking.setSortBy('car.name')">Car</th>
                  <th ng-click="adminBooking.setSortBy('pickupDate')">Pickup Date</th>
                  <th ng-click="adminBooking.setSortBy('dropoffDate')">Return Date</th>
                  <th ng-click="adminBooking.setSortBy('totalAmount')">Price</th>
                  <th ng-click="adminBooking.setSortBy('paymentStatus')">Payment Status</th>
                  <th ng-click="adminBooking.setSortBy('status')">Booking Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr ng-repeat="booking in adminBooking.filteredBookings">
                  <td>{{booking._id.substr(-5)}}</td>
                  <td>{{booking.user.username || 'Unknown'}}</td>
                  <td>{{(booking.car.name + ' ' + booking.car.brand) || 'Unknown'}}</td>
                  <td>{{adminBooking.formatDate(booking.pickupDate)}}</td>
                  <td>{{adminBooking.formatDate(booking.dropoffDate)}}</td>
                  <td>‚Çπ{{booking.totalAmount}}</td>
                  <td>
                    <span class="status-badge" ng-class="{
                      'status-pending': booking.paymentStatus === 'Pending',
                      'status-confirmed': booking.paymentStatus === 'Paid'
                    }">{{booking.paymentStatus || 'Pending'}}</span>
                  </td>
                  <td>
                    <span class="status-badge" ng-class="{
                      'status-pending': booking.status === 'Pending',
                      'status-confirmed': booking.status === 'Confirmed',
                      'status-cancelled': booking.status === 'Cancelled',
                      'status-ongoing': booking.status === 'Ongoing'
                    }">{{booking.status}}</span>
                  </td>
                  <td>
                    <div class="booking-actions">
                      <button class="booking-btn booking-btn-view" ng-click="adminBooking.showDetailView(booking)">
                        View
                      </button>
                      <button class="booking-btn booking-btn-confirm" 
                              ng-if="booking.status !== 'Confirmed'" 
                              ng-click="adminBooking.confirmBooking(booking)"
                              ng-disabled="booking.updating">
                        Confirm
                      </button>
                      <button class="booking-btn booking-btn-cancel" 
                              ng-if="booking.status !== 'Cancelled'" 
                              ng-click="adminBooking.cancelBooking(booking)"
                              ng-disabled="booking.updating">
                        Cancel
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <!-- No Bookings Message -->
          <div ng-if="adminBooking.filteredBookings.length === 0" class="no-data-message">
            No bookings found matching your criteria.
          </div>
        </div>

        <!-- DETAIL VIEW -->
        <div ng-show="adminBooking.viewMode === 'detail'" class="booking-detail-container">
          <div class="booking-detail-header">
            <h3>Booking Details - #{{adminBooking.selectedBooking._id.slice(-6)}}</h3>
            <div class="booking-detail-actions">
              <button class="btn-outline" ng-if="!adminBooking.editMode" ng-click="adminBooking.enableEdit()">Edit Booking</button>
              <button class="btn-confirm" ng-if="adminBooking.editMode" ng-click="adminBooking.saveBooking()">Save Changes</button>
              <button class="btn-outline" ng-if="adminBooking.editMode" ng-click="adminBooking.cancelEdit()">Cancel</button>
            </div>
          </div>

          <div class="booking-detail-content">
            <!-- View Mode -->
            <div ng-if="!adminBooking.editMode" class="booking-detail-grid">
              <div class="detail-section">
                <h4>Customer Information</h4>
                <div class="detail-row">
                  <span class="detail-label">Name:</span>
                  <span class="detail-value">{{adminBooking.selectedBooking.user.username}}</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Email:</span>
                  <span class="detail-value">{{adminBooking.selectedBooking.user.email}}</span>
                </div>
              </div>

              <div class="detail-section">
                <h4>Car Information</h4>
                <div class="detail-row">
                  <span class="detail-label">Car:</span>
                  <span class="detail-value">{{adminBooking.selectedBooking.car.name}}</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Brand:</span>
                  <span class="detail-value">{{adminBooking.selectedBooking.car.brand}}</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Fuel Type:</span>
                  <span class="detail-value">{{adminBooking.selectedBooking.car.fuelType}}</span>
                </div>
              </div>

              <div class="detail-section">
                <h4>Booking Details</h4>
                <div class="detail-row">
                  <span class="detail-label">Pickup Date:</span>
                  <span class="detail-value">{{adminBooking.selectedBooking.pickupDate | date:'medium'}}</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Pickup Location:</span>
                  <span class="detail-value">{{adminBooking.selectedBooking.pickupLocation}}</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Return Date:</span>
                  <span class="detail-value">{{adminBooking.selectedBooking.dropoffDate | date:'medium'}}</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Return Location:</span>
                  <span class="detail-value">{{adminBooking.selectedBooking.dropoffLocation}}</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Total Amount:</span>
                  <span class="detail-value">‚Çπ{{adminBooking.selectedBooking.totalAmount}}</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Status:</span>
                  <span class="status-badge" ng-class="{
                    'status-pending': adminBooking.selectedBooking.status === 'Pending',
                    'status-confirmed': adminBooking.selectedBooking.status === 'Confirmed',
                    'status-ongoing': adminBooking.selectedBooking.status === 'Ongoing',
                    'status-cancelled': adminBooking.selectedBooking.status === 'Cancelled'
                  }">{{adminBooking.selectedBooking.status}}</span>
                </div>
              </div>
            </div>

            <!-- Edit Mode -->
            <div ng-if="adminBooking.editMode" class="booking-edit-form">
              <div class="form-grid">
                <label>
                  <span>Pickup Date</span>
                  <input type="datetime-local" ng-model="adminBooking.selectedBooking.pickupDate">
                </label>
                <label>
                  <span>Pickup Location</span>
                  <input type="text" ng-model="adminBooking.selectedBooking.pickupLocation">
                </label>
                <label>
                  <span>Return Date</span>
                  <input type="datetime-local" ng-model="adminBooking.selectedBooking.dropoffDate">
                </label>
                <label>
                  <span>Return Location</span>
                  <input type="text" ng-model="adminBooking.selectedBooking.dropoffLocation">
                </label>
                <label>
                  <span>Total Amount</span>
                  <input type="number" ng-model="adminBooking.selectedBooking.totalAmount">
                </label>
                <label>
                  <span>Status</span>
                  <select ng-model="adminBooking.selectedBooking.status">
                    <option value="Pending">Pending</option>
                    <option value="Confirmed">Confirmed</option>
                    <option value="Ongoing">Ongoing</option>
                    <option value="Cancelled">Cancelled</option>
                  </select>
                </label>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="booking-actions" ng-if="!adminBooking.editMode">
              <button class="btn-confirm" ng-if="adminBooking.selectedBooking.status === 'Pending'" ng-click="adminBooking.confirmBooking(adminBooking.selectedBooking)">Confirm Booking</button>
              <button class="btn-cancel" ng-if="adminBooking.selectedBooking.status !== 'Cancelled'" ng-click="adminBooking.cancelBooking(adminBooking.selectedBooking)">Cancel Booking</button>
            </div>
          </div>
        </div>


      </div>

      <!-- ANALYTICS SECTION -->
      <div ng-show="adminDashboard.activeSection === 'analytics'" class="analytics-section">
        <div class="analytics-header">
          <h2>Analytics Dashboard</h2>
          <div class="analytics-filters">
            <select ng-model="adminDashboard.selectedTimeFilter" ng-change="adminDashboard.loadAllAnalytics()" class="time-filter">
              <option value="today">Today</option>
              <option value="week">This Week</option>
              <option value="month">This Month</option>
              <option value="all">All Time</option>
            </select>
          </div>
        </div>
        
        <!-- Analytics Module Navigation -->
        <div class="analytics-nav">
          <button ng-class="{'active': adminDashboard.activeAnalyticsModule === 'booking'}" 
                  ng-click="adminDashboard.switchAnalyticsModule('booking')" class="nav-btn">
            üìä Booking Analytics
          </button>
          <button ng-class="{'active': adminDashboard.activeAnalyticsModule === 'revenue'}" 
                  ng-click="adminDashboard.switchAnalyticsModule('revenue')" class="nav-btn">
            üí∞ Revenue Analytics
          </button>
          <button ng-class="{'active': adminDashboard.activeAnalyticsModule === 'user'}" 
                  ng-click="adminDashboard.switchAnalyticsModule('user')" class="nav-btn">
            üë• User Analytics
          </button>
          <button ng-class="{'active': adminDashboard.activeAnalyticsModule === 'car'}" 
                  ng-click="adminDashboard.switchAnalyticsModule('car')" class="nav-btn">
            üöó Car Analytics
          </button>
        </div>
        
        <!-- Booking Analytics Module -->
        <div ng-show="adminDashboard.activeAnalyticsModule === 'booking'" class="analytics-module booking-analytics">
          <div class="module-header">
            <div class="module-title">
              <i class="fas fa-calendar-check"></i>
              <h2>Booking Analytics</h2>
            </div>
            <div class="module-subtitle">
              <p>Comprehensive overview of booking performance and trends</p>
            </div>
          </div>
          
          <!-- Enhanced Stats Cards -->
          <div class="stats-grid">
            <div class="stat-card total-bookings">
              <div class="stat-icon">
                <i class="fas fa-clipboard-list"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number">{{adminDashboard.bookingAnalytics.totalBookings || 0}}</div>
                <div class="stat-label">Total Bookings</div>
                <div class="stat-change positive">+12% from last month</div>
              </div>
            </div>
            
            <div class="stat-card confirmed-bookings">
              <div class="stat-icon">
                <i class="fas fa-check-circle"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number">{{adminDashboard.bookingAnalytics.confirmedBookings || 0}}</div>
                 <div class="stat-label">Confirmed</div>
                 <div class="stat-percentage">{{((adminDashboard.bookingAnalytics.confirmedBookings / adminDashboard.bookingAnalytics.totalBookings) * 100 || 0).toFixed(1)}}%</div>
              </div>
            </div>
            
            <div class="stat-card pending-bookings">
              <div class="stat-icon">
                <i class="fas fa-clock"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number">{{adminDashboard.bookingAnalytics.pendingBookings || 0}}</div>
                 <div class="stat-label">Pending</div>
                 <div class="stat-percentage">{{((adminDashboard.bookingAnalytics.pendingBookings / adminDashboard.bookingAnalytics.totalBookings) * 100 || 0).toFixed(1)}}%</div>
              </div>
            </div>
            
            <div class="stat-card cancelled-bookings">
              <div class="stat-icon">
                <i class="fas fa-times-circle"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number">{{adminDashboard.bookingAnalytics.cancelledBookings || 0}}</div>
                 <div class="stat-label">Cancelled</div>
                 <div class="stat-percentage">{{((adminDashboard.bookingAnalytics.cancelledBookings / adminDashboard.bookingAnalytics.totalBookings) * 100 || 0).toFixed(1)}}%</div>
              </div>
            </div>
          </div>
          
          <!-- Enhanced Charts Section -->
          <div class="charts-container">
            <div class="chart-card">
              <div class="chart-header">
                <div class="chart-title">
                  <i class="fas fa-chart-pie"></i>
                  <h4>Booking Status Distribution</h4>
                </div>
                <div class="chart-actions">
                  <button class="btn-chart-action" ng-click="adminDashboard.toggleFullscreen('bookingStatusChart')" title="Fullscreen">
                    <i class="fas fa-expand"></i>
                  </button>
                  <button class="btn-chart-action" ng-click="adminDashboard.downloadChart('bookingStatusChart')" title="Download Chart">
                    <i class="fas fa-download"></i>
                  </button>
                  <button class="btn-chart-action" ng-click="adminDashboard.refreshChart('bookingStatusChart')" title="Refresh">
                    <i class="fas fa-sync-alt"></i>
                  </button>
                </div>
              </div>
              <div class="chart-body">
                <canvas id="bookingStatusChart"></canvas>
              </div>
              <div class="chart-footer">
                <div class="chart-legend">
                  <div class="legend-item">
                    <span class="legend-color confirmed"></span>
                    <span>Confirmed ({{adminDashboard.bookingAnalytics.confirmedBookings || 0}})</span>
                   </div>
                   <div class="legend-item">
                     <span class="legend-color pending"></span>
                     <span>Pending ({{adminDashboard.bookingAnalytics.pendingBookings || 0}})</span>
                   </div>
                   <div class="legend-item">
                     <span class="legend-color cancelled"></span>
                     <span>Cancelled ({{adminDashboard.bookingAnalytics.cancelledBookings || 0}})</span>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="chart-card">
              <div class="chart-header">
                <div class="chart-title">
                  <i class="fas fa-chart-line"></i>
                  <h4>Booking Trends Over Time</h4>
                </div>
                <div class="chart-actions">
                  <button class="btn-chart-action" ng-click="adminDashboard.toggleFullscreen('bookingTrendChart')" title="Fullscreen">
                    <i class="fas fa-expand"></i>
                  </button>
                  <button class="btn-chart-action" ng-click="adminDashboard.downloadChart('bookingTrendChart')" title="Download Chart">
                    <i class="fas fa-download"></i>
                  </button>
                  <button class="btn-chart-action" ng-click="adminDashboard.refreshChart('bookingTrendChart')" title="Refresh">
                    <i class="fas fa-sync-alt"></i>
                  </button>
                </div>
              </div>
              <div class="chart-body">
                <canvas id="bookingTrendChart"></canvas>
              </div>
              <div class="chart-footer">
                <div class="trend-summary">
                  <div class="trend-item">
                    <span class="trend-label">Peak Day:</span>
                    <span class="trend-value">Monday</span>
                  </div>
                  <div class="trend-item">
                    <span class="trend-label">Avg. Daily:</span>
                    <span class="trend-value">{{(adminDashboard.bookingAnalytics.totalBookings / 30 || 0).toFixed(1)}}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Additional Insights -->
          <div class="insights-section">
            <div class="insight-card">
              <div class="insight-header">
                <i class="fas fa-lightbulb"></i>
                <h4>Key Insights</h4>
              </div>
              <div class="insight-content">
                <ul class="insight-list">
                  <li ng-if="adminDashboard.bookingAnalytics.confirmedBookings > adminDashboard.bookingAnalytics.pendingBookings">
                     <i class="fas fa-check text-success"></i>
                     High confirmation rate indicates good customer satisfaction
                   </li>
                   <li ng-if="adminDashboard.bookingAnalytics.pendingBookings > adminDashboard.bookingAnalytics.confirmedBookings">
                     <i class="fas fa-exclamation-triangle text-warning"></i>
                     Consider following up on pending bookings to improve conversion
                   </li>
                   <li ng-if="adminDashboard.bookingAnalytics.cancelledBookings > (adminDashboard.bookingAnalytics.totalBookings * 0.2)">
                     <i class="fas fa-times text-danger"></i>
                     High cancellation rate - review booking policies
                   </li>
                </ul>
              </div>
            </div>
            
            <div class="quick-actions">
              <h4><i class="fas fa-bolt"></i> Quick Actions</h4>
              <div class="action-buttons">
                <button class="btn-action primary">
                  <i class="fas fa-plus"></i>
                  New Booking
                </button>
                <button class="btn-action secondary">
                  <i class="fas fa-file-export"></i>
                  Export Report
                </button>
                <button class="btn-action tertiary">
                  <i class="fas fa-cog"></i>
                  Settings
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Revenue Analytics Module -->
        <div ng-show="adminDashboard.activeAnalyticsModule === 'revenue'" class="analytics-module revenue-analytics">
          <div class="module-header">
            <div class="module-title">
              <i class="fas fa-rupee-sign"></i>
              <h2>Revenue Analytics</h2>
            </div>
            <div class="module-subtitle">
              <p>Comprehensive overview of revenue performance and trends</p>
            </div>
          </div>
          
          <!-- Revenue Stats Grid -->
          <div class="stats-grid">
            <div class="stat-card" data-aos="fade-up" data-aos-delay="100">
              <div class="stat-icon">
                <i class="fas fa-rupee-sign"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number">‚Çπ{{adminDashboard.revenueAnalytics.totalRevenue || 0 | number}}</div>
                <div class="stat-label">Total Revenue</div>
                <div class="stat-change positive">+15% from last month</div>
              </div>
            </div>
            
            <div class="stat-card" data-aos="fade-up" data-aos-delay="200">
              <div class="stat-icon">
                <i class="fas fa-check-circle"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number">‚Çπ{{adminDashboard.revenueAnalytics.confirmedRevenue || 0 | number}}</div>
                <div class="stat-label">Confirmed Revenue</div>
                <div class="stat-percentage">{{((adminDashboard.revenueAnalytics.confirmedRevenue / adminDashboard.revenueAnalytics.totalRevenue) * 100 || 0).toFixed(1)}}%</div>
              </div>
            </div>
            
            <div class="stat-card" data-aos="fade-up" data-aos-delay="300">
              <div class="stat-icon">
                <i class="fas fa-clock"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number">‚Çπ{{adminDashboard.revenueAnalytics.pendingRevenue || 0 | number}}</div>
                <div class="stat-label">Pending Revenue</div>
                <div class="stat-percentage">{{((adminDashboard.revenueAnalytics.pendingRevenue / adminDashboard.revenueAnalytics.totalRevenue) * 100 || 0).toFixed(1)}}%</div>
              </div>
            </div>
            
            <div class="stat-card" data-aos="fade-up" data-aos-delay="400">
              <div class="stat-icon">
                <i class="fas fa-chart-bar"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number">‚Çπ{{adminDashboard.revenueAnalytics.averageBookingValue || 0 | number}}</div>
                <div class="stat-label">Avg Booking Value</div>
                <div class="stat-change positive">+8% from last month</div>
              </div>
            </div>
          </div>
          
          <!-- Revenue Charts Container -->
          <div class="charts-container">
            <div class="chart-card" data-aos="fade-up" data-aos-delay="500">
              <div class="chart-header">
                <div class="chart-title">
                  <i class="fas fa-chart-line"></i>
                  <h4>Revenue Trends Over Time</h4>
                </div>
                <div class="chart-actions">
                  <button class="btn-chart-action" title="Fullscreen" ng-click="adminDashboard.toggleFullscreen('revenueTrendChart')">
                    <i class="fas fa-expand"></i>
                  </button>
                  <button class="btn-chart-action" title="Download" ng-click="adminDashboard.downloadChart('revenueTrendChart')">
                    <i class="fas fa-download"></i>
                  </button>
                  <button class="btn-chart-action" title="Refresh" ng-click="adminDashboard.refreshChart('revenueTrendChart')">
                    <i class="fas fa-sync-alt"></i>
                  </button>
                </div>
              </div>
              <div class="chart-body">
                <canvas id="revenueTrendChart" width="400" height="300"></canvas>
              </div>
              <div class="chart-footer">
                <div class="chart-legend">
                  <div class="legend-item">
                    <span class="legend-color revenue"></span>
                    <span>Total Revenue (‚Çπ{{adminDashboard.revenueAnalytics.totalRevenue || 0 | number}})</span>
                  </div>
                  <div class="legend-item">
                    <span class="legend-color confirmed"></span>
                    <span>Confirmed (‚Çπ{{adminDashboard.revenueAnalytics.confirmedRevenue || 0 | number}})</span>
                  </div>
                </div>
                <div class="trend-summary">
                  <div class="trend-item">
                    <span class="trend-label">Monthly Growth:</span>
                    <span class="trend-value">+15.2%</span>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="chart-card" data-aos="fade-up" data-aos-delay="600">
              <div class="chart-header">
                <div class="chart-title">
                  <i class="fas fa-trophy"></i>
                  <h4>Top Revenue Generating Cars</h4>
                </div>
                <div class="chart-actions">
                  <button class="btn-chart-action" title="Fullscreen" ng-click="adminDashboard.toggleFullscreen('topRevenueChart')">
                    <i class="fas fa-expand"></i>
                  </button>
                  <button class="btn-chart-action" title="Download" ng-click="adminDashboard.downloadChart('topRevenueChart')">
                    <i class="fas fa-download"></i>
                  </button>
                  <button class="btn-chart-action" title="Refresh" ng-click="adminDashboard.refreshChart('topRevenueChart')">
                    <i class="fas fa-sync-alt"></i>
                  </button>
                </div>
              </div>
              <div class="chart-body">
                <canvas id="topRevenueChart" width="400" height="300"></canvas>
              </div>
              <div class="chart-footer">
                <div class="chart-legend">
                  <div class="legend-item">
                    <span class="legend-color top-car"></span>
                    <span>Highest Revenue Car</span>
                  </div>
                  <div class="legend-item">
                    <span class="legend-color avg-car"></span>
                    <span>Average Revenue</span>
                  </div>
                </div>
                <div class="trend-summary">
                  <div class="trend-item">
                    <span class="trend-label">Top Performer:</span>
                    <span class="trend-value">{{adminDashboard.revenueAnalytics.topCar || 'N/A'}}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Revenue Insights Section -->
          <div class="insights-section">
            <div class="insight-card">
              <div class="insight-header">
                <i class="fas fa-lightbulb"></i>
                <h4>Revenue Insights</h4>
              </div>
              <div class="insight-content">
                <ul class="insight-list">
                  <li ng-if="adminDashboard.revenueAnalytics.confirmedRevenue > (adminDashboard.revenueAnalytics.totalRevenue * 0.8)">
                    <i class="fas fa-check text-success"></i>
                    Excellent revenue confirmation rate - strong business performance
                  </li>
                  <li ng-if="adminDashboard.revenueAnalytics.pendingRevenue > (adminDashboard.revenueAnalytics.totalRevenue * 0.3)">
                    <i class="fas fa-exclamation-triangle text-warning"></i>
                    High pending revenue - consider follow-up strategies
                  </li>
                  <li ng-if="adminDashboard.revenueAnalytics.averageBookingValue > 5000">
                    <i class="fas fa-star text-success"></i>
                    Premium booking value indicates quality service positioning
                  </li>
                </ul>
              </div>
            </div>
            
            <div class="quick-actions">
              <div class="action-header">
                <i class="fas fa-bolt"></i>
                <h4>Quick Actions</h4>
              </div>
              <div class="action-buttons">
                <button class="btn-action primary">
                  <i class="fas fa-file-invoice"></i>
                  Generate Revenue Report
                </button>
                <button class="btn-action secondary">
                  <i class="fas fa-chart-pie"></i>
                  Revenue Breakdown
                </button>
                <button class="btn-action tertiary">
                  <i class="fas fa-cog"></i>
                  Revenue Settings
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- User Analytics Module -->
        <div ng-show="adminDashboard.activeAnalyticsModule === 'user'" class="analytics-module user-analytics">
          <div class="module-header">
            <div class="module-title">
              <i class="fas fa-users"></i>
              <h2>User Analytics</h2>
            </div>
            <div class="module-subtitle">
              <p>Comprehensive overview of user engagement and activity patterns</p>
            </div>
          </div>
          
          <div class="stats-grid">
            <div class="stat-card total-users">
              <div class="stat-icon">
                <i class="fas fa-users"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number">{{adminDashboard.userAnalytics.totalUsers || 0}}</div>
                <div class="stat-label">Total Users</div>
                <div class="stat-change positive">+12% from last month</div>
              </div>
            </div>
            
            <div class="stat-card active-users">
              <div class="stat-icon">
                <i class="fas fa-user-check"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number">{{adminDashboard.userAnalytics.activeUsers || 0}}</div>
                <div class="stat-label">Active Users</div>
                <div class="stat-percentage">{{((adminDashboard.userAnalytics.activeUsers / adminDashboard.userAnalytics.totalUsers) * 100 || 0).toFixed(1)}}%</div>
              </div>
            </div>
            
            <div class="stat-card booking-users">
              <div class="stat-icon">
                <i class="fas fa-calendar-check"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number">{{adminDashboard.userAnalytics.activeBookingUsers || 0}}</div>
                <div class="stat-label">Users with Bookings</div>
                <div class="stat-percentage">{{((adminDashboard.userAnalytics.activeBookingUsers / adminDashboard.userAnalytics.totalUsers) * 100 || 0).toFixed(1)}}%</div>
              </div>
            </div>
            
            <div class="stat-card activity-rate">
              <div class="stat-icon">
                <i class="fas fa-chart-line"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number">{{adminDashboard.userAnalytics.userActivityRate || 0}}%</div>
                <div class="stat-label">Activity Rate</div>
                <div class="stat-change positive">+5% from last month</div>
              </div>
            </div>
          </div>
          
          <div class="charts-container">
            <div class="chart-card">
              <div class="chart-header">
                <div class="chart-title">
                  <i class="fas fa-chart-pie"></i>
                  <h4>User Status Distribution</h4>
                </div>
                <div class="chart-actions">
                  <button class="btn-chart-action" ng-click="adminDashboard.toggleFullscreen('userStatusChart')" title="Fullscreen">
                    <i class="fas fa-expand"></i>
                  </button>
                  <button class="btn-chart-action" ng-click="adminDashboard.downloadChart('userStatusChart')" title="Download">
                    <i class="fas fa-download"></i>
                  </button>
                  <button class="btn-chart-action" ng-click="adminDashboard.refreshChart('userStatusChart')" title="Refresh">
                    <i class="fas fa-sync-alt"></i>
                  </button>
                </div>
              </div>
              <div class="chart-body">
                <canvas id="userStatusChart"></canvas>
              </div>
              <div class="chart-footer">
                <div class="chart-legends">
                  <div class="legend-item">
                    <span class="legend-color active"></span>
                    <span>Active Users ({{adminDashboard.userAnalytics.activeUsers || 0}})</span>
                  </div>
                  <div class="legend-item">
                    <span class="legend-color inactive"></span>
                    <span>Inactive Users ({{(adminDashboard.userAnalytics.totalUsers - adminDashboard.userAnalytics.activeUsers) || 0}})</span>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="chart-card">
              <div class="chart-header">
                <div class="chart-title">
                  <i class="fas fa-chart-line"></i>
                  <h4>User Registration Trends</h4>
                </div>
                <div class="chart-actions">
                  <button class="btn-chart-action" ng-click="adminDashboard.toggleFullscreen('userRegistrationChart')" title="Fullscreen">
                    <i class="fas fa-expand"></i>
                  </button>
                  <button class="btn-chart-action" ng-click="adminDashboard.downloadChart('userRegistrationChart')" title="Download">
                    <i class="fas fa-download"></i>
                  </button>
                  <button class="btn-chart-action" ng-click="adminDashboard.refreshChart('userRegistrationChart')" title="Refresh">
                    <i class="fas fa-sync-alt"></i>
                  </button>
                </div>
              </div>
              <div class="chart-body">
                <canvas id="userRegistrationChart"></canvas>
              </div>
              <div class="chart-footer">
                <div class="trend-summary">
                  <div class="trend-item">
                    <span class="trend-label">Monthly Growth:</span>
                    <span class="trend-value">+15.2%</span>
                  </div>
                  <div class="trend-item">
                    <span class="trend-label">Avg. Daily:</span>
                    <span class="trend-value">{{(adminDashboard.userAnalytics.totalUsers / 30 || 0).toFixed(1)}}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- User Insights Section -->
          <div class="insights-section">
            <div class="insight-card">
              <div class="insight-header">
                <i class="fas fa-lightbulb"></i>
                <h4>Key Insights</h4>
              </div>
              <div class="insight-content">
                <ul class="insight-list">
                  <li ng-if="adminDashboard.userAnalytics.activeUsers > (adminDashboard.userAnalytics.totalUsers * 0.7)">
                    <i class="fas fa-check text-success"></i>
                    High user engagement rate indicates strong platform adoption
                  </li>
                  <li ng-if="adminDashboard.userAnalytics.activeBookingUsers > (adminDashboard.userAnalytics.totalUsers * 0.3)">
                    <i class="fas fa-star text-success"></i>
                    Good conversion rate from users to active bookers
                  </li>
                  <li ng-if="adminDashboard.userAnalytics.userActivityRate > 60">
                    <i class="fas fa-thumbs-up text-success"></i>
                    Excellent user activity rate shows platform value
                  </li>
                </ul>
              </div>
            </div>
            
            <div class="quick-actions">
              <h4><i class="fas fa-bolt"></i> Quick Actions</h4>
              <div class="action-buttons">
                <button class="btn-action primary">
                  <i class="fas fa-user-plus"></i>
                  Add New User
                </button>
                <button class="btn-action secondary">
                  <i class="fas fa-file-export"></i>
                  Export User Report
                </button>
                <button class="btn-action tertiary">
                  <i class="fas fa-cog"></i>
                  User Settings
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Car Analytics Module -->
        <div ng-show="adminDashboard.activeAnalyticsModule === 'car'" class="analytics-module car-analytics">
          <div class="module-header">
            <div class="module-title">
              <i class="fas fa-car"></i>
              <h2>Car Analytics</h2>
            </div>
            <div class="module-subtitle">
              <p>Monitor car availability, utilization rates, and fleet performance metrics to optimize your vehicle inventory and maximize revenue potential.</p>
            </div>
          </div>
          
          <div class="stats-grid">
            <div class="stat-card total-cars">
              <div class="stat-number">{{adminDashboard.carAnalytics.totalCars || 0}}</div>
              <div class="stat-label">Total Cars</div>
              <div class="stat-change positive">+5%</div>
            </div>
            <div class="stat-card available-cars">
              <div class="stat-number">{{adminDashboard.carAnalytics.availableCars || 0}}</div>
              <div class="stat-label">Available Cars</div>
              <div class="stat-percentage">{{((adminDashboard.carAnalytics.availableCars / adminDashboard.carAnalytics.totalCars) * 100) || 0 | number:1}}%</div>
            </div>
            <div class="stat-card booked-cars">
              <div class="stat-number">{{adminDashboard.carAnalytics.bookedCarsCount || 0}}</div>
              <div class="stat-label">Cars with Bookings</div>
              <div class="stat-change positive">+18%</div>
            </div>
            <div class="stat-card utilization-rate">
              <div class="stat-number">{{adminDashboard.carAnalytics.utilizationRate || 0}}%</div>
              <div class="stat-label">Utilization Rate</div>
              <div class="stat-change positive">+7%</div>
            </div>
          </div>
          
          <div class="charts-container">
            <div class="chart-card">
              <div class="chart-header">
                <div class="chart-title">
                  <i class="fas fa-chart-bar"></i>
                  <h4>Car Availability Status</h4>
                </div>
                <div class="chart-actions">
                  <button class="btn-chart-action" ng-click="adminDashboard.toggleFullscreen('carAvailabilityChart')" title="Fullscreen">
                    <i class="fas fa-expand"></i>
                  </button>
                  <button class="btn-chart-action" ng-click="adminDashboard.downloadChart('carAvailabilityChart')" title="Download">
                    <i class="fas fa-download"></i>
                  </button>
                  <button class="btn-chart-action" ng-click="adminDashboard.refreshChart('carAvailabilityChart')" title="Refresh">
                    <i class="fas fa-sync-alt"></i>
                  </button>
                </div>
              </div>
              <div class="chart-body">
                <canvas id="carAvailabilityChart"></canvas>
              </div>
              <div class="chart-footer">
                <div class="chart-legends">
                  <div class="legend-item">
                    <span class="legend-color" style="background: #28a745;"></span>
                    <span>Available</span>
                  </div>
                  <div class="legend-item">
                    <span class="legend-color" style="background: #ffc107;"></span>
                    <span>Booked</span>
                  </div>
                  <div class="legend-item">
                    <span class="legend-color" style="background: #dc3545;"></span>
                    <span>Maintenance</span>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="chart-card">
              <div class="chart-header">
                <div class="chart-title">
                  <i class="fas fa-star"></i>
                  <h4>Most Popular Cars</h4>
                </div>
                <div class="chart-actions">
                  <button class="btn-chart-action" ng-click="adminDashboard.toggleFullscreen('popularCarsChart')" title="Fullscreen">
                    <i class="fas fa-expand"></i>
                  </button>
                  <button class="btn-chart-action" ng-click="adminDashboard.downloadChart('popularCarsChart')" title="Download">
                    <i class="fas fa-download"></i>
                  </button>
                  <button class="btn-chart-action" ng-click="adminDashboard.refreshChart('popularCarsChart')" title="Refresh">
                    <i class="fas fa-sync-alt"></i>
                  </button>
                </div>
              </div>
              <div class="chart-body">
                <canvas id="popularCarsChart"></canvas>
              </div>
              <div class="chart-footer">
                <div class="trend-summary">
                  <p><i class="fas fa-arrow-up text-success"></i> Car utilization improved by 7% this month</p>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Car Insights Section -->
          <div class="insights-section">
            <div class="insight-card">
              <div class="insight-header">
                <i class="fas fa-lightbulb"></i>
                <h4>Key Insights</h4>
              </div>
              <div class="insight-content">
                <ul class="insight-list">
                  <li ng-if="adminDashboard.carAnalytics.utilizationRate > 70">
                    <i class="fas fa-check text-success"></i>
                    High utilization rate indicates efficient fleet management
                  </li>
                  <li ng-if="adminDashboard.carAnalytics.availableCars > (adminDashboard.carAnalytics.totalCars * 0.3)">
                    <i class="fas fa-star text-success"></i>
                    Good availability ensures customer satisfaction
                  </li>
                  <li ng-if="adminDashboard.carAnalytics.bookedCarsCount > (adminDashboard.carAnalytics.totalCars * 0.5)">
                    <i class="fas fa-thumbs-up text-success"></i>
                    Strong booking performance across the fleet
                  </li>
                </ul>
              </div>
            </div>
            
            <div class="quick-actions">
              <h4><i class="fas fa-bolt"></i> Quick Actions</h4>
              <div class="action-buttons">
                <button class="btn-action primary">
                  <i class="fas fa-plus"></i>
                  Add New Car
                </button>
                <button class="btn-action secondary">
                  <i class="fas fa-file-export"></i>
                  Export Fleet Report
                </button>
                <button class="btn-action tertiary">
                  <i class="fas fa-cog"></i>
                  Fleet Settings
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<style>
/* Admin License Preview Styles */
.admin-license-preview {
  margin-top: 10px;
  width: 100%;
}

.license-status {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 15px;
}

.license-uploaded {
  color: #28a745;
  font-weight: 500;
}

.admin-license-document {
  background: #f8f9fa;
  border: 2px solid #e9ecef;
  border-radius: 8px;
  padding: 20px;
  margin-top: 15px;
}

.license-preview-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
  padding-bottom: 10px;
  border-bottom: 1px solid #dee2e6;
}

.license-preview-header h6 {
  margin: 0;
  color: #495057;
  font-size: 1rem;
  display: flex;
  align-items: center;
  gap: 8px;
}

.btn-download {
  background: #007bff;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 0.875rem;
  display: flex;
  align-items: center;
  gap: 5px;
  transition: background-color 0.2s;
}

.btn-download:hover {
  background: #0056b3;
}

.license-display {
  margin-bottom: 15px;
  text-align: center;
}

.license-image {
  max-width: 100%;
  max-height: 400px;
  border: 1px solid #dee2e6;
  border-radius: 4px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.license-file-info {
  padding: 40px;
  text-align: center;
  color: #6c757d;
}

.license-file-info i {
  color: #dc3545;
  margin-bottom: 10px;
}

.license-details {
  background: white;
  border: 1px solid #dee2e6;
  border-radius: 4px;
  padding: 15px;
}

.license-info-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
  border-bottom: 1px solid #f8f9fa;
}

.license-info-row:last-child {
  border-bottom: none;
}

.info-label {
  font-weight: 600;
  color: #495057;
}

.info-value {
  color: #6c757d;
  font-family: monospace;
  font-size: 0.9rem;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .license-preview-header {
    flex-direction: column;
    gap: 10px;
    align-items: flex-start;
  }
  
  .license-info-row {
    flex-direction: column;
    align-items: flex-start;
    gap: 5px;
  }
  
  .license-image {
    max-height: 250px;
  }
}
</style>
