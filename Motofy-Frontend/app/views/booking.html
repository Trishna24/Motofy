<!-- app/views/booking.html -->
<div class="my-bookings-container">
  <div class="bookings-header">
    <h2>My Bookings</h2>
    <div class="bookings-stats" ng-if="!booking.loading && booking.bookings.length">
      <div class="stat-item">
        <span class="stat-number">{{booking.bookings.length}}</span>
        <span class="stat-label">Total Bookings</span>
      </div>
      <div class="stat-item">
        <span class="stat-number">{{(booking.bookings | filter:{status:'Confirmed'}).length}}</span>
        <span class="stat-label">Confirmed</span>
      </div>
      <div class="stat-item">
        <span class="stat-number">{{(booking.bookings | filter:{status:'Pending'}).length}}</span>
        <span class="stat-label">Pending</span>
      </div>
    </div>
  </div>
  
  <div class="booking-controls" ng-if="!booking.loading && booking.bookings.length">
    <div class="booking-search">
      <div class="search-input-wrapper">
        <i class="search-icon">üîç</i>
        <input type="text" ng-model="booking.searchTerm" placeholder="Search by car name, location, or booking ID...">
      </div>
    </div>
    <div class="booking-filters">
      <select ng-model="booking.statusFilter" class="filter-select">
        <option value="">All Status</option>
        <option value="Pending">Pending</option>
        <option value="Confirmed">Confirmed</option>
        <option value="Ongoing">Ongoing</option>
        <option value="Cancelled">Cancelled</option>
      </select>
    </div>
  </div>
  
  <!-- Loading State -->
  <div ng-if="booking.loading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Loading your bookings...</p>
  </div>
  
  <!-- Error State -->
  <div ng-if="booking.error" class="error-state">
    <div class="error-icon">‚ö†Ô∏è</div>
    <h3>Oops! Something went wrong</h3>
    <p>{{booking.error}}</p>
    <button class="btn-retry" ng-click="booking.loadBookings()">Try Again</button>
  </div>
  
  <!-- Success Message -->
  <div ng-if="booking.success" class="success-message">
    <div class="success-icon">‚úÖ</div>
    <span>{{booking.success}}</span>
  </div>
  
  <!-- Bookings Grid -->
  <div class="booking-cards" ng-if="!booking.loading && booking.bookings.length">
    <div class="booking-card" ng-repeat="b in booking.bookings | filter:booking.searchTerm | filter:{status: booking.statusFilter || undefined}">
      <div class="booking-card-header">
        <div class="booking-id">Booking #{{b._id.slice(-6)}}</div>
        <div class="booking-date">{{b.createdAt | date:'dd MMM yyyy'}}</div>
      </div>
      
      <div class="booking-card-content">
        <div class="booking-card-image">
          <img ng-src="{{booking.imageUrl(b.car.image)}}" alt="{{b.car.name}}" loading="lazy">
          <div class="image-overlay">
            <span class="status-badge" ng-class="{
              'status-pending': b.status === 'Pending',
              'status-confirmed': b.status === 'Confirmed',
              'status-cancelled': b.status === 'Cancelled',
              'status-ongoing': b.status === 'Ongoing'
            }">{{b.status}}</span>
          </div>
        </div>
        
        <div class="booking-card-details">
          <h3 class="car-name">{{b.car.name}} <span class="car-brand">{{b.car.brand}}</span></h3>
          
          <div class="booking-info-grid">
            <div class="info-item">
              <div class="info-icon">üìÖ</div>
              <div class="info-content">
                <span class="info-label">Pickup</span>
                <span class="info-value">{{b.pickupDate | date:'dd MMM yyyy, h:mm a'}}</span>
                <span class="info-location">{{b.pickupLocation}}</span>
              </div>
            </div>
            
            <div class="info-item">
              <div class="info-icon">üîÑ</div>
              <div class="info-content">
                <span class="info-label">Return</span>
                <span class="info-value">{{b.dropoffDate | date:'dd MMM yyyy, h:mm a'}}</span>
                <span class="info-location">{{b.dropoffLocation || b.pickupLocation}}</span>
              </div>
            </div>
            
            <div class="info-item">
              <div class="info-icon">‚è±Ô∏è</div>
              <div class="info-content">
                <span class="info-label">Duration</span>
                <span class="info-value">{{((b.dropoffDate | date:'yyyy-MM-dd') | date) - ((b.pickupDate | date:'yyyy-MM-dd') | date) | number:0}} days</span>
              </div>
            </div>
            
            <div class="info-item price-item">
              <div class="info-icon">üí∞</div>
              <div class="info-content">
                <span class="info-label">Total Amount</span>
                <span class="info-value price">‚Çπ{{b.totalAmount | number:0}}</span>
              </div>
            </div>
          </div>
          
          <div class="booking-actions">
            <button class="btn-primary" ng-click="booking.viewDetails(b)">
              <span class="btn-icon">üëÅÔ∏è</span>
              View Details
            </button>
            <button class="btn-danger" ng-if="b.status !== 'Cancelled' && b.status !== 'Completed'" 
                    ng-click="booking.cancel(b)" ng-disabled="b.cancelling">
              <span class="btn-icon" ng-if="!b.cancelling">‚ùå</span>
              <span class="btn-spinner" ng-if="b.cancelling"></span>
              {{b.cancelling ? 'Cancelling...' : 'Cancel'}}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Empty State -->
  <div ng-if="!booking.loading && !booking.bookings.length && !booking.error" class="empty-state">
    <div class="empty-icon">üöó</div>
    <h3>No bookings yet</h3>
    <p>Start your journey by booking your first car!</p>
    <a href="#!/cars" class="btn-primary btn-large">
      <span class="btn-icon">üîç</span>
      Browse Cars
    </a>
  </div>
  
  <!-- No Results State -->
  <div ng-if="!booking.loading && booking.bookings.length && !(booking.bookings | filter:booking.searchTerm | filter:{status: booking.statusFilter || undefined}).length" class="no-results-state">
    <div class="no-results-icon">üîç</div>
    <h3>No bookings found</h3>
    <p>Try adjusting your search or filter criteria</p>
    <button class="btn-secondary" ng-click="booking.searchTerm = ''; booking.statusFilter = ''">Clear Filters</button>
  </div>

  <!-- Booking Details Modal -->
  <div class="modal-overlay" ng-if="booking.showDetailsModal" ng-click="booking.closeDetailsModal()"></div>
  <div class="modal-container" ng-if="booking.showDetailsModal">
    <div class="modal-content booking-details-modal" ng-click="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Booking Details</h3>
        <button class="modal-close" ng-click="booking.closeDetailsModal()">&times;</button>
      </div>
      
      <div class="booking-details-content" ng-if="booking.selectedBooking">
        <div class="booking-detail-header">
          <div class="detail-booking-id">
            <span class="detail-label">Booking ID:</span>
            <span class="detail-value booking-id-value">{{booking.selectedBooking._id}}</span>
          </div>
          <div class="detail-status">
            <span class="status-badge large" ng-class="{
              'status-pending': booking.selectedBooking.status === 'Pending',
              'status-confirmed': booking.selectedBooking.status === 'Confirmed',
              'status-cancelled': booking.selectedBooking.status === 'Cancelled',
              'status-ongoing': booking.selectedBooking.status === 'Ongoing'
            }">{{booking.selectedBooking.status}}</span>
          </div>
        </div>
        
        <div class="booking-detail-sections">
          <div class="detail-section">
            <h4>üöó Vehicle Information</h4>
            <div class="detail-grid">
              <div class="booking-detail-row">
                <span class="detail-label">Car:</span>
                <span class="detail-value">{{booking.selectedBooking.car.name}} {{booking.selectedBooking.car.brand}}</span>
              </div>
            </div>
          </div>
          
          <div class="detail-section">
            <h4>üìÖ Booking Timeline</h4>
            <div class="detail-grid">
              <div class="booking-detail-row">
                <span class="detail-label">Pickup:</span>
                <span class="detail-value">{{booking.selectedBooking.pickupDate | date:'dd MMM yyyy, h:mm a'}}</span>
              </div>
              <div class="booking-detail-row">
                <span class="detail-label">Location:</span>
                <span class="detail-value">{{booking.selectedBooking.pickupLocation}}</span>
              </div>
              <div class="booking-detail-row">
                <span class="detail-label">Return:</span>
                <span class="detail-value">{{booking.selectedBooking.dropoffDate | date:'dd MMM yyyy, h:mm a'}}</span>
              </div>
              <div class="booking-detail-row">
                <span class="detail-label">Return Location:</span>
                <span class="detail-value">{{booking.selectedBooking.dropoffLocation || booking.selectedBooking.pickupLocation}}</span>
              </div>
              <div class="booking-detail-row">
                <span class="detail-label">Duration:</span>
                <span class="detail-value">{{((booking.selectedBooking.dropoffDate | date:'yyyy-MM-dd') | date) - ((booking.selectedBooking.pickupDate | date:'yyyy-MM-dd') | date) | number:0}} days</span>
              </div>
            </div>
          </div>
          
          <div class="detail-section">
            <h4>üí∞ Payment Information</h4>
            <div class="detail-grid">
              <div class="booking-detail-row">
                <span class="detail-label">Total Amount:</span>
                <span class="detail-value price-large">‚Çπ{{booking.selectedBooking.totalAmount | number:0}}</span>
              </div>
            </div>
          </div>
        </div>
        
        <div class="booking-detail-actions" ng-if="booking.selectedBooking.status !== 'Cancelled'">
          <button class="btn-danger" ng-click="booking.cancel(booking.selectedBooking); booking.closeDetailsModal()" ng-disabled="booking.selectedBooking.cancelling">
            <span class="btn-icon" ng-if="!booking.selectedBooking.cancelling">‚ùå</span>
            <span class="btn-spinner" ng-if="booking.selectedBooking.cancelling"></span>
            {{booking.selectedBooking.cancelling ? 'Cancelling...' : 'Cancel Booking'}}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>