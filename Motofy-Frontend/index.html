<!DOCTYPE html>
<html lang="en" ng-app="motofyApp">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Motofy</title>
  <!-- AngularJS 1.x CDN -->
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular-route.min.js"></script>
  <!-- ng-file-upload for file handling -->
  <script src="https://cdn.jsdelivr.net/npm/ng-file-upload@12.2.13/dist/ng-file-upload.min.js"></script>
  <!-- Chart.js for data visualization -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Toastr for notifications -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Michroma&display=swap" rel="stylesheet">
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <!-- Google Sign-In SDK -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <link rel="stylesheet" href="app/assets/css/styles.css">
</head>
<body>
  <div ng-controller="MainController as main">
    <header ng-show="main.showNavbar">
      <div class="header-inner container">
        <span class="brand">Motofy</span>
        <div class="nav-center">
          <nav>
            <a href="#/">Home</a>
            <a href="#/cars" ng-click="main.goToCars()">Cars</a>
          </nav>
        </div>
        <div class="header-controls">
          <a ng-if="main.isAdmin()" href="#/admin/dashboard" class="admin-dashboard-btn" ng-click="main.goToAdminDashboard()">Admin Dashboard</a>
          <div class="user-menu" ng-if="!main.isAdmin()" ng-click="$event.stopPropagation()">
            <div class="user-icon" ng-click="main.toggleDropdown($event)">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="8" r="4" stroke="#f3f6fa" stroke-width="2"/>
                <path d="M4 20c0-4 4-6 8-6s8 2 8 6" stroke="#f3f6fa" stroke-width="2"/>
              </svg>
            </div>
            <div class="dropdown" ng-show="main.dropdownOpen">
              <a href ng-if="!main.isLoggedIn()" ng-click="main.openLoginModal(); main.closeDropdown()">Login</a>
              <a href ng-if="!main.isLoggedIn()" ng-click="main.openSignupModal(); main.closeDropdown()">Sign Up</a>
              <a href="#/profile" ng-if="main.isLoggedIn()" ng-click="main.closeDropdown()">My Profile</a>
              <a href="#/bookings" ng-if="main.isLoggedIn()" ng-click="main.closeDropdown()">My Bookings</a>
              <button ng-if="main.isLoggedIn()" ng-click="main.logout(); main.closeDropdown();">Logout</button>
            </div>
          </div>
        </div>
      </div>
    </header>
    <!-- Modal Overlay for Blur -->
    <div class="modal-overlay" ng-if="main.isModalOpen()" ng-click="main.closeModal()"></div>
    <!-- Role Selection Modal -->
    <div class="modal-container" ng-if="main.showRoleModal">
      <div class="modal-content" ng-click="$event.stopPropagation()">
        <button class="modal-close" ng-click="main.closeModal()">&times;</button>
        <h2>Select Login Type</h2>
        <div style="display:flex; gap:1em; justify-content:center; margin-top:1.5em;">
          <button style="padding:1em 2em; font-size:1.1em; background:#7ed957; color:#232b36; border:none; border-radius:8px; cursor:pointer;"
                  ng-click="main.chooseRole('user')">
            User Login
          </button>
          <button style="padding:1em 2em; font-size:1.1em; background:#313a49; color:#fff; border:1px solid #7ed957; border-radius:8px; cursor:pointer;"
                  ng-click="main.chooseRole('admin')">
            Admin Login
          </button>
        </div>
      </div>
    </div>

    <!-- Login Modal -->
    <div class="modal-container" ng-if="main.showLoginModal">
      <div class="modal-content" ng-controller="AuthController as auth" ng-click="$event.stopPropagation()">
        <button class="modal-close" ng-click="main.closeModal()">&times;</button>
        <h2 class="model-title"> Login</h2>
        <form class="auth-form" ng-submit="auth.login()">
          <label>Email or Username:</label>
          <input type="text" ng-model="auth.loginData.loginInput" required autocomplete="username">
          <label>Password:</label>
          <input type="password" ng-model="auth.loginData.password" required autocomplete="current-password">
          <button type="submit">Login</button>
          <p style="color:red;" ng-if="auth.error">{{auth.error}}</p>
          <p style="color:green;" ng-if="auth.success">{{auth.success}}</p>
        </form>
        <!-- Google Sign-In Button -->
        <div style="text-align: center; margin: 1em 0;">
          <div style="margin: 0.5em 0; color: #666; font-size: 0.9em;">or</div>
          <button type="button" ng-click="auth.googleSignIn()" class="google-signin-btn">
            <svg width="18" height="18" viewBox="0 0 24 24" style="margin-right: 8px;">
              <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
              <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
              <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
              <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
            </svg>
            Sign in with Google
          </button>
        </div>
        <div class="modal-switch">
          Don't have an account? <a href ng-click="main.openSignupModal()">Sign Up</a>
        </div>
      </div>
    </div>
    <!-- Signup Modal -->
    <div class="modal-container" ng-if="main.showSignupModal">
      <div class="modal-content" ng-controller="AuthController as auth" ng-click="$event.stopPropagation()">
        <button class="modal-close" ng-click="main.closeModal()">&times;</button>
        <h2 class="model-title">Sign Up</h2>
        <form class="auth-form" ng-submit="auth.signup()">
          <label>Username:</label>
          <input type="text" ng-model="auth.signupData.username" required autocomplete="username">
          <label>Email:</label>
          <input type="email" ng-model="auth.signupData.email" required autocomplete="email">
          <label>Phone Number:</label>
          <input type="tel" ng-model="auth.signupData.phone" placeholder="Enter your phone number" required>
          <label>Password:</label>
          <input type="password" ng-model="auth.signupData.password" required autocomplete="new-password">
          <button type="submit">Sign Up</button>
          <p style="color:red;" ng-if="auth.error">{{auth.error}}</p>
          <p style="color:green;" ng-if="auth.success">{{auth.success}}</p>
        </form>
        <!-- Google Sign-In Button -->
        <div style="text-align: center; margin: 1em 0;">
          <div style="margin: 0.5em 0; color: #666; font-size: 0.9em;">or</div>
          <button type="button" ng-click="auth.googleSignIn()" class="google-signin-btn">
            <svg width="18" height="18" viewBox="0 0 24 24" style="margin-right: 8px;">
              <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
              <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
              <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
              <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
            </svg>
            Sign up with Google
          </button>
        </div>
        <div class="modal-switch">
          Already have an account? <a href ng-click="main.openLoginModal()">Login</a>
        </div>
      </div>
    </div>
    <div class="container main-content" ng-class="{'blur-bg': main.isModalOpen()}">
      <main ng-view></main>
      <!-- Floating AI Chat Button and Popup -->
      <div ng-controller="AIController as ai" style="z-index:9999;">
          <!-- Floating Button -->
          <button ng-click="ai.toggleChat()" class="ai-float-btn" title="Chat with AI">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none">
              <circle cx="12" cy="12" r="10" stroke="#2c3e50" stroke-width="2"/>
              <path d="M8 15h8M8 11h8M8 7h8" stroke="#2c3e50" stroke-width="2"/>
            </svg>
          </button>

          <!-- Chat Popup -->
          <div class="ai-chat-popup" ng-show="ai.chatOpen">
            <div class="ai-chat-header">
              <span>AI Chat</span>
              <button class="ai-chat-close" ng-click="ai.toggleChat()">&times;</button>
            </div>

            <div class="ai-chat-messages" id="aiChatMessages">
              <div ng-repeat="msg in ai.messages track by $index"
                  ng-class="{'ai-user-msg': msg.sender === 'user', 'ai-bot-msg': msg.sender === 'bot', 'typing': msg.isTyping}">
                <strong ng-if="msg.sender === 'user'">You:</strong>
                <strong ng-if="msg.sender === 'bot'">AI:</strong>
                <span>{{msg.text}}</span>
              </div>
            </div>

            <form class="ai-chat-input" ng-submit="ai.sendMessage($event)" novalidate>
              <input type="text" ng-model="ai.input" placeholder="Type your message..."
                    ng-disabled="ai.loading" autocomplete="off" required />
              <button type="submit" ng-disabled="ai.loading || !ai.input">{{ai.loading ? '...' : 'Send'}}</button>
            </form>
          </div>
        </div>
    </div>
    <!-- App Scripts -->
    <script src="app/app.module.js"></script>
    <!-- Configuration -->
    <script src="app/config/config.js"></script>
    <script src="app/app.routes.js"></script>
    <script src="app/services/api.service.js"></script>
    <script src="app/controllers/main.controller.js"></script>
    <script src="app/controllers/auth.controller.js"></script>
    <script src="app/controllers/car.controller.js"></script>
    <script src="app/controllers/booking.controller.js"></script>
    <script src="app/controllers/admin-login.controller.js"></script>
    <script src="app/controllers/admin-dashboard.controller.js"></script>
    <script src="app/controllers/admin-car.controller.js"></script>
    <script src="app/controllers/admin-booking.controller.js"></script>
    <script src="app/controllers/admin-user.controller.js"></script>
    <script src="app/controllers/ai.controller.js"></script>
    <script src="app/controllers/profile.controller.js"></script>
    <script src="app/controllers/payment.controller.js"></script>
      <script>
       // Close dropdown on outside click
       document.body.addEventListener('click', function() {
         var scope = angular.element(document.querySelector('[ng-controller="MainController as main"]')).scope();
         if(scope && scope.main) {
           scope.$apply(function() { scope.main.dropdownOpen = false; });
         }
       });
       
     </script>
  </div>
</body>
</html>